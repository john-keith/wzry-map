THREE.GLTFLoader=function(){function e(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.dracoLoader=null}function a(){var r={};return{get:function(e){return r[e]},add:function(e,t){r[e]=t},remove:function(e){delete r[e]},removeAll:function(){r={}}}}e.prototype={constructor:e,crossOrigin:"anonymous",load:function(t,r,e,a){var n,s=this;n=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(t),s.manager.itemStart(t);var i=function(e){a?a(e):console.error(e),s.manager.itemError(t),s.manager.itemEnd(t)},o=new THREE.FileLoader(s.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.load(t,function(e){try{s.parse(e,n,function(e){r(e),s.manager.itemEnd(t)},i)}catch(e){i(e)}},e,i)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setDRACOLoader:function(e){return this.dracoLoader=e,this},parse:function(e,t,r,a){var n,s={};if("string"==typeof e)n=e;else if(THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4))===h){try{s[m.KHR_BINARY_GLTF]=new E(e)}catch(e){return void(a&&a(e))}n=s[m.KHR_BINARY_GLTF].content}else n=THREE.LoaderUtils.decodeText(new Uint8Array(e));var i=JSON.parse(n);if(void 0===i.asset||i.asset.version[0]<2)a&&a(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(i.extensionsUsed)for(var o=0;o<i.extensionsUsed.length;++o){var l=i.extensionsUsed[o],p=i.extensionsRequired||[];switch(l){case m.KHR_LIGHTS_PUNCTUAL:s[l]=new c(i);break;case m.KHR_MATERIALS_UNLIT:s[l]=new d(i);break;case m.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[l]=new T(i);break;case m.KHR_DRACO_MESH_COMPRESSION:s[l]=new f(i,this.dracoLoader);break;case m.MSFT_TEXTURE_DDS:s[m.MSFT_TEXTURE_DDS]=new u;break;case m.KHR_TEXTURE_TRANSFORM:s[m.KHR_TEXTURE_TRANSFORM]=new v(i);break;default:0<=p.indexOf(l)&&console.warn('THREE.GLTFLoader: Unknown extension "'+l+'".')}}new V(i,s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(r,a)}}};var m={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function u(){if(!THREE.DDSLoader)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=m.MSFT_TEXTURE_DDS,this.ddsLoader=new THREE.DDSLoader}function c(e){this.name=m.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[m.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function d(){this.name=m.KHR_MATERIALS_UNLIT}c.prototype.loadLight=function(e){var t,r=this.lightDefs[e],a=new THREE.Color(16777215);void 0!==r.color&&a.fromArray(r.color);var n=void 0!==r.range?r.range:0;switch(r.type){case"directional":(t=new THREE.DirectionalLight(a)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new THREE.PointLight(a)).distance=n;break;case"spot":(t=new THREE.SpotLight(a)).distance=n,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,t.angle=r.spot.outerConeAngle,t.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+r.type+'".')}return t.position.set(0,0,0),t.decay=2,void 0!==r.intensity&&(t.intensity=r.intensity),t.name=r.name||"light_"+e,Promise.resolve(t)},d.prototype.getMaterialType=function(){return THREE.MeshBasicMaterial},d.prototype.extendParams=function(e,t,r){var a=[];e.color=new THREE.Color(1,1,1),e.opacity=1;var n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){var s=n.baseColorFactor;e.color.fromArray(s),e.opacity=s[3]}void 0!==n.baseColorTexture&&a.push(r.assignTexture(e,"map",n.baseColorTexture))}return Promise.all(a)};var h="glTF",l=12,p={JSON:1313821514,BIN:5130562};function E(e){this.name=m.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,l);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==h)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var r=new DataView(e,l),a=0;a<r.byteLength;){var n=r.getUint32(a,!0);a+=4;var s=r.getUint32(a,!0);if(a+=4,s===p.JSON){var i=new Uint8Array(e,l+a,n);this.content=THREE.LoaderUtils.decodeText(i)}else if(s===p.BIN){var o=l+a;this.body=e.slice(o,o+n)}a+=n}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function f(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=m.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t}function v(){this.name=m.KHR_TEXTURE_TRANSFORM}function T(){return{name:m.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return THREE.ShaderMaterial},extendParams:function(e,t,r){var a=t.extensions[this.name],n=THREE.ShaderLib.standard,s=THREE.UniformsUtils.clone(n.uniforms),i=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),o=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),p=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),u=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),c=n.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",i).replace("#include <metalnessmap_pars_fragment>",o).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",p).replace("#include <lights_physical_fragment>",u);delete s.roughness,delete s.metalness,delete s.roughnessMap,delete s.metalnessMap,s.specular={value:(new THREE.Color).setHex(1118481)},s.glossiness={value:.5},s.specularMap={value:null},s.glossinessMap={value:null},e.vertexShader=n.vertexShader,e.fragmentShader=c,e.uniforms=s,e.defines={STANDARD:""},e.color=new THREE.Color(1,1,1),e.opacity=1;var d=[];if(Array.isArray(a.diffuseFactor)){var h=a.diffuseFactor;e.color.fromArray(h),e.opacity=h[3]}if(void 0!==a.diffuseTexture&&d.push(r.assignTexture(e,"map",a.diffuseTexture)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==a.glossinessFactor?a.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(a.specularFactor)&&e.specular.fromArray(a.specularFactor),void 0!==a.specularGlossinessTexture){var m=a.specularGlossinessTexture;d.push(r.assignTexture(e,"glossinessMap",m)),d.push(r.assignTexture(e,"specularMap",m))}return Promise.all(d)},createMaterial:function(e){var t=new THREE.ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return t.isGLTFSpecularGlossinessMaterial=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t.extensions.derivatives=!0,t},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var r=this.specularGlossinessParams,a=0,n=r.length;a<n;a++)t[r[a]]=e[r[a]];return t},refreshUniforms:function(e,t,r,a,n,s){if(!0===n.isGLTFSpecularGlossinessMaterial){var i,o=n.uniforms,l=n.defines;o.opacity.value=n.opacity,o.diffuse.value.copy(n.color),o.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),o.map.value=n.map,o.specularMap.value=n.specularMap,o.alphaMap.value=n.alphaMap,o.lightMap.value=n.lightMap,o.lightMapIntensity.value=n.lightMapIntensity,o.aoMap.value=n.aoMap,o.aoMapIntensity.value=n.aoMapIntensity,n.map?i=n.map:n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.glossinessMap?i=n.glossinessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap&&(i=n.emissiveMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),o.uvTransform.value.copy(i.matrix)),n.envMap&&(o.envMap.value=n.envMap,o.envMapIntensity.value=n.envMapIntensity,o.flipEnvMap.value=n.envMap.isCubeTexture?-1:1,o.reflectivity.value=n.reflectivity,o.refractionRatio.value=n.refractionRatio,o.maxMipLevel.value=e.properties.get(n.envMap).__maxMipLevel),o.specular.value.copy(n.specular),o.glossiness.value=n.glossiness,o.glossinessMap.value=n.glossinessMap,o.emissiveMap.value=n.emissiveMap,o.bumpMap.value=n.bumpMap,o.normalMap.value=n.normalMap,o.displacementMap.value=n.displacementMap,o.displacementScale.value=n.displacementScale,o.displacementBias.value=n.displacementBias,null!==o.glossinessMap.value&&void 0===l.USE_GLOSSINESSMAP&&(l.USE_GLOSSINESSMAP="",l.USE_ROUGHNESSMAP=""),null===o.glossinessMap.value&&void 0!==l.USE_GLOSSINESSMAP&&(delete l.USE_GLOSSINESSMAP,delete l.USE_ROUGHNESSMAP)}}}}function H(e,t,r,a){THREE.Interpolant.call(this,e,t,r,a)}f.prototype.decodePrimitive=function(e,t){var r=this.json,a=this.dracoLoader,n=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,i={},o={},l={};for(var p in s){var u=F[p]||p.toLowerCase();i[u]=s[p]}for(p in e.attributes){u=F[p]||p.toLowerCase();if(void 0!==s[p]){var c=r.accessors[e.attributes[p]],d=A[c.componentType];l[u]=d,o[u]=!0===c.normalized}}return t.getDependency("bufferView",n).then(function(e){return new Promise(function(n){a.decodeDracoFile(e,function(e){for(var t in e.attributes){var r=e.attributes[t],a=o[t];void 0!==a&&(r.normalized=a)}n(e)},i,l)})})},v.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},((H.prototype=Object.create(THREE.Interpolant.prototype)).constructor=H).prototype.beforeStart_=H.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,r=this.sampleValues,a=this.valueSize,n=e*a*3+a,s=0;s!==a;s++)t[s]=r[n+s];return t},H.prototype.afterEnd_=H.prototype.copySampleValue_,H.prototype.interpolate_=function(e,t,r,a){for(var n=this.resultBuffer,s=this.sampleValues,i=this.valueSize,o=2*i,l=3*i,p=a-t,u=(r-t)/p,c=u*u,d=c*u,h=e*l,m=h-l,E=-2*d+3*c,f=d-c,v=1-E,T=f-c+u,g=0;g!==i;g++){var R=s[m+g+i],M=s[m+g+o]*p,S=s[h+g+i],y=s[h+g]*p;n[g]=v*R+T*M+E*S+f*y}return n};var s,g=0,R=1,M=2,S=3,y=4,L=5,_=6,A=(Number,THREE.Matrix3,THREE.Matrix4,THREE.Vector2,THREE.Vector3,THREE.Vector4,THREE.Texture,{5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}),x={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},w={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},b=(THREE.BackSide,THREE.FrontSide,THREE.NeverDepth,THREE.LessDepth,THREE.EqualDepth,THREE.LessEqualDepth,THREE.GreaterEqualDepth,THREE.NotEqualDepth,THREE.GreaterEqualDepth,THREE.AlwaysDepth,THREE.AddEquation,THREE.SubtractEquation,THREE.ReverseSubtractEquation,THREE.ZeroFactor,THREE.OneFactor,THREE.SrcColorFactor,THREE.OneMinusSrcColorFactor,THREE.SrcAlphaFactor,THREE.OneMinusSrcAlphaFactor,THREE.DstAlphaFactor,THREE.OneMinusDstAlphaFactor,THREE.DstColorFactor,THREE.OneMinusDstColorFactor,THREE.SrcAlphaSaturateFactor,{SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}),F={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},I={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},P={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},U="OPAQUE",D="MASK",C="BLEND",O={"image/png":THREE.RGBAFormat,"image/jpeg":THREE.RGBFormat};function G(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e}function N(e,t,r){for(var a in r.extensions)void 0===e[a]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[a]=r.extensions[a])}function B(e,t){void 0!==t.extras&&("object"==typeof t.extras?e.userData=t.extras:console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function k(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var r=0,a=t.weights.length;r<a;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){var n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(r=0,a=n.length;r<a;r++)e.morphTargetDictionary[n[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function K(e){for(var t="",r=Object.keys(e).sort(),a=0,n=r.length;a<n;a++)t+=r[a]+":"+e[r[a]]+";";return t}function j(e){if(e.isInterleavedBufferAttribute){for(var t=e.count,r=e.itemSize,a=e.array.slice(0,t*r),n=0,s=0;n<t;++n)a[s++]=e.getX(n),2<=r&&(a[s++]=e.getY(n)),3<=r&&(a[s++]=e.getZ(n)),4<=r&&(a[s++]=e.getW(n));return new THREE.BufferAttribute(a,r,e.normalized)}return e.clone()}function V(e,t,r){this.json=e||{},this.extensions=t||{},this.options=r||{},this.cache=new a,this.primitiveCache={},this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}function X(r,e,a){var t=e.attributes,n=[];function s(e,t){return a.getDependency("accessor",e).then(function(e){r.addAttribute(t,e)})}for(var i in t){var o=F[i]||i.toLowerCase();o in r.attributes||n.push(s(t[i],o))}if(void 0!==e.indices&&!r.index){var l=a.getDependency("accessor",e.indices).then(function(e){r.setIndex(e)});n.push(l)}return B(r,e),Promise.all(n).then(function(){return void 0!==e.targets?function(h,m,e){for(var E=!1,f=!1,t=0,r=m.length;t<r&&(void 0!==(s=m[t]).POSITION&&(E=!0),void 0!==s.NORMAL&&(f=!0),!E||!f);t++);if(!E&&!f)return Promise.resolve(h);var a=[],n=[];for(t=0,r=m.length;t<r;t++){var s=m[t];if(E){var i=void 0!==s.POSITION?e.getDependency("accessor",s.POSITION):h.attributes.position;a.push(i)}f&&(i=void 0!==s.NORMAL?e.getDependency("accessor",s.NORMAL):h.attributes.normal,n.push(i))}return Promise.all([Promise.all(a),Promise.all(n)]).then(function(e){for(var t=e[0],r=e[1],a=0,n=t.length;a<n;a++)h.attributes.position!==t[a]&&(t[a]=j(t[a]));for(a=0,n=r.length;a<n;a++)h.attributes.normal!==r[a]&&(r[a]=j(r[a]));for(a=0,n=m.length;a<n;a++){var s=m[a],i="morphTarget"+a;if(E&&void 0!==s.POSITION){var o=t[a];o.name=i;for(var l=h.attributes.position,p=0,u=o.count;p<u;p++)o.setXYZ(p,o.getX(p)+l.getX(p),o.getY(p)+l.getY(p),o.getZ(p)+l.getZ(p))}if(f&&void 0!==s.NORMAL){var c=r[a];c.name=i;var d=h.attributes.normal;for(p=0,u=c.count;p<u;p++)c.setXYZ(p,c.getX(p)+d.getX(p),c.getY(p)+d.getY(p),c.getZ(p)+d.getZ(p))}}return E&&(h.morphAttributes.position=t),f&&(h.morphAttributes.normal=r),h})}(r,e.targets,a):r})}return V.prototype.parse=function(r,e){var a=this,n=this.json,s=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(e){var t={scene:e[0][n.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:n.asset,parser:a,userData:{}};N(s,t,n),r(t)}).catch(e)},V.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],a={},n={},s=0,i=t.length;s<i;s++)for(var o=t[s].joints,l=0,p=o.length;l<p;l++)e[o[l]].isBone=!0;for(var u=0,c=e.length;u<c;u++){var d=e[u];void 0!==d.mesh&&(void 0===a[d.mesh]&&(a[d.mesh]=n[d.mesh]=0),a[d.mesh]++,void 0!==d.skin&&(r[d.mesh].isSkinnedMesh=!0))}this.json.meshReferences=a,this.json.meshUses=n},V.prototype.getDependency=function(e,t){var r=e+":"+t,a=this.cache.get(r);if(!a){switch(e){case"scene":a=this.loadScene(t);break;case"node":a=this.loadNode(t);break;case"mesh":a=this.loadMesh(t);break;case"accessor":a=this.loadAccessor(t);break;case"bufferView":a=this.loadBufferView(t);break;case"buffer":a=this.loadBuffer(t);break;case"material":a=this.loadMaterial(t);break;case"texture":a=this.loadTexture(t);break;case"skin":a=this.loadSkin(t);break;case"animation":a=this.loadAnimation(t);break;case"camera":a=this.loadCamera(t);break;case"light":a=this.extensions[m.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,a)}return a},V.prototype.getDependencies=function(r){var e=this.cache.get(r);if(!e){var a=this,t=this.json[r+("mesh"===r?"es":"s")]||[];e=Promise.all(t.map(function(e,t){return a.getDependency(r,t)})),this.cache.add(r,e)}return e},V.prototype.loadBuffer=function(e){var r=this.json.buffers[e],a=this.fileLoader;if(r.type&&"arraybuffer"!==r.type)throw new Error("THREE.GLTFLoader: "+r.type+" buffer type is not supported.");if(void 0===r.uri&&0===e)return Promise.resolve(this.extensions[m.KHR_BINARY_GLTF].body);var n=this.options;return new Promise(function(e,t){a.load(G(r.uri,n.path),e,void 0,function(){t(new Error('THREE.GLTFLoader: Failed to load buffer "'+r.uri+'".'))})})},V.prototype.loadBufferView=function(e){var a=this.json.bufferViews[e];return this.getDependency("buffer",a.buffer).then(function(e){var t=a.byteLength||0,r=a.byteOffset||0;return e.slice(r,r+t)})},V.prototype.loadAccessor=function(e){var S=this,y=this.json,H=this.json.accessors[e];if(void 0===H.bufferView&&void 0===H.sparse)return Promise.resolve(null);var t=[];return void 0!==H.bufferView?t.push(this.getDependency("bufferView",H.bufferView)):t.push(null),void 0!==H.sparse&&(t.push(this.getDependency("bufferView",H.sparse.indices.bufferView)),t.push(this.getDependency("bufferView",H.sparse.values.bufferView))),Promise.all(t).then(function(e){var t,r,a=e[0],n=b[H.type],s=A[H.componentType],i=s.BYTES_PER_ELEMENT,o=i*n,l=H.byteOffset||0,p=void 0!==H.bufferView?y.bufferViews[H.bufferView].byteStride:void 0,u=!0===H.normalized;if(p&&p!==o){var c="InterleavedBuffer:"+H.bufferView+":"+H.componentType,d=S.cache.get(c);d||(t=new s(a),d=new THREE.InterleavedBuffer(t,p/i),S.cache.add(c,d)),r=new THREE.InterleavedBufferAttribute(d,n,l/i,u)}else t=null===a?new s(H.count*n):new s(a,l,H.count*n),r=new THREE.BufferAttribute(t,n,u);if(void 0!==H.sparse){var h=b.SCALAR,m=A[H.sparse.indices.componentType],E=H.sparse.indices.byteOffset||0,f=H.sparse.values.byteOffset||0,v=new m(e[1],E,H.sparse.count*h),T=new s(e[2],f,H.sparse.count*n);null!==a&&r.setArray(r.array.slice());for(var g=0,R=v.length;g<R;g++){var M=v[g];if(r.setX(M,T[g*n]),2<=n&&r.setY(M,T[g*n+1]),3<=n&&r.setZ(M,T[g*n+2]),4<=n&&r.setW(M,T[g*n+3]),5<=n)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return r})},V.prototype.loadTexture=function(e){var r,t=this,a=this.json,n=this.options,s=this.textureLoader,i=window.URL||window.webkitURL,o=a.textures[e],l=o.extensions||{},p=(r=l[m.MSFT_TEXTURE_DDS]?a.images[l[m.MSFT_TEXTURE_DDS].source]:a.images[o.source]).uri,u=!1;return void 0!==r.bufferView&&(p=t.getDependency("bufferView",r.bufferView).then(function(e){u=!0;var t=new Blob([e],{type:r.mimeType});return p=i.createObjectURL(t)})),Promise.resolve(p).then(function(r){var a=THREE.Loader.Handlers.get(r);return a||(a=l[m.MSFT_TEXTURE_DDS]?t.extensions[m.MSFT_TEXTURE_DDS].ddsLoader:s),new Promise(function(e,t){a.load(G(r,n.path),e,void 0,t)})}).then(function(e){!0===u&&i.revokeObjectURL(p),e.flipY=!1,void 0!==o.name&&(e.name=o.name),r.mimeType in O&&(e.format=O[r.mimeType]);var t=(a.samplers||{})[o.sampler]||{};return e.magFilter=x[t.magFilter]||THREE.LinearFilter,e.minFilter=x[t.minFilter]||THREE.LinearMipMapLinearFilter,e.wrapS=w[t.wrapS]||THREE.RepeatWrapping,e.wrapT=w[t.wrapT]||THREE.RepeatWrapping,e})},V.prototype.assignTexture=function(r,a,n){var s=this;return this.getDependency("texture",n.index).then(function(e){if(!e.isCompressedTexture)switch(a){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":e.format=THREE.RGBFormat}if(s.extensions[m.KHR_TEXTURE_TRANSFORM]){var t=void 0!==n.extensions?n.extensions[m.KHR_TEXTURE_TRANSFORM]:void 0;t&&(e=s.extensions[m.KHR_TEXTURE_TRANSFORM].extendTexture(e,t))}r[a]=e})},V.prototype.assignFinalMaterial=function(e){var t=e.geometry,r=e.material,a=this.extensions,n=void 0!==t.attributes.tangent,s=void 0!==t.attributes.color,i=void 0===t.attributes.normal,o=!0===e.isSkinnedMesh,l=0<Object.keys(t.morphAttributes).length,p=l&&void 0!==t.morphAttributes.normal;if(e.isPoints){var u="PointsMaterial:"+r.uuid,c=this.cache.get(u);c||(c=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(c,r),c.color.copy(r.color),c.map=r.map,c.lights=!1,this.cache.add(u,c)),r=c}else if(e.isLine){u="LineBasicMaterial:"+r.uuid;var d=this.cache.get(u);d||(d=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(d,r),d.color.copy(r.color),d.lights=!1,this.cache.add(u,d)),r=d}if(n||s||i||o||l){u="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(u+="specular-glossiness:"),o&&(u+="skinning:"),n&&(u+="vertex-tangents:"),s&&(u+="vertex-colors:"),i&&(u+="flat-shading:"),l&&(u+="morph-targets:"),p&&(u+="morph-normals:");var h=this.cache.get(u);h||(h=r.isGLTFSpecularGlossinessMaterial?a[m.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(r):r.clone(),o&&(h.skinning=!0),n&&(h.vertexTangents=!0),s&&(h.vertexColors=THREE.VertexColors),i&&(h.flatShading=!0),l&&(h.morphTargets=!0),p&&(h.morphNormals=!0),this.cache.add(u,h)),r=h}r.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),t.addAttribute("uv2",new THREE.BufferAttribute(t.attributes.uv.array,2))),r.isGLTFSpecularGlossinessMaterial&&(e.onBeforeRender=a[m.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms),e.material=r},V.prototype.loadMaterial=function(e){var t,r=this,a=this.json,n=this.extensions,s=a.materials[e],i={},o=s.extensions||{},l=[];if(o[m.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var p=n[m.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=p.getMaterialType(),l.push(p.extendParams(i,s,r))}else if(o[m.KHR_MATERIALS_UNLIT]){var u=n[m.KHR_MATERIALS_UNLIT];t=u.getMaterialType(),l.push(u.extendParams(i,s,r))}else{t=THREE.MeshStandardMaterial;var c=s.pbrMetallicRoughness||{};if(i.color=new THREE.Color(1,1,1),i.opacity=1,Array.isArray(c.baseColorFactor)){var d=c.baseColorFactor;i.color.fromArray(d),i.opacity=d[3]}void 0!==c.baseColorTexture&&l.push(r.assignTexture(i,"map",c.baseColorTexture)),i.metalness=void 0!==c.metallicFactor?c.metallicFactor:1,i.roughness=void 0!==c.roughnessFactor?c.roughnessFactor:1,void 0!==c.metallicRoughnessTexture&&(l.push(r.assignTexture(i,"metalnessMap",c.metallicRoughnessTexture)),l.push(r.assignTexture(i,"roughnessMap",c.metallicRoughnessTexture)))}!0===s.doubleSided&&(i.side=THREE.DoubleSide);var h=s.alphaMode||U;return h===C?i.transparent=!0:(i.transparent=!1,h===D&&(i.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&t!==THREE.MeshBasicMaterial&&(l.push(r.assignTexture(i,"normalMap",s.normalTexture)),i.normalScale=new THREE.Vector2(1,1),void 0!==s.normalTexture.scale&&i.normalScale.set(s.normalTexture.scale,s.normalTexture.scale)),void 0!==s.occlusionTexture&&t!==THREE.MeshBasicMaterial&&(l.push(r.assignTexture(i,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(i.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&t!==THREE.MeshBasicMaterial&&(i.emissive=(new THREE.Color).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&t!==THREE.MeshBasicMaterial&&l.push(r.assignTexture(i,"emissiveMap",s.emissiveTexture)),Promise.all(l).then(function(){var e;return e=t===THREE.ShaderMaterial?n[m.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(i):new t(i),void 0!==s.name&&(e.name=s.name),e.map&&(e.map.encoding=THREE.sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=THREE.sRGBEncoding),e.specularMap&&(e.specularMap.encoding=THREE.sRGBEncoding),B(e,s),s.extensions&&N(n,e,s),e})},V.prototype.loadGeometries=function(e){var r=this,a=this.extensions,t=this.primitiveCache;function n(t){return a[m.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,r).then(function(e){return X(e,t,r)})}for(var s,i,o=[],l=0,p=e.length;l<p;l++){var u,c=e[l],d=(void 0,(i=(s=c).extensions&&s.extensions[m.KHR_DRACO_MESH_COMPRESSION])?"draco:"+i.bufferView+":"+i.indices+":"+K(i.attributes):s.indices+":"+K(s.attributes)+":"+s.mode),h=t[d];if(h)o.push(h.promise);else u=c.extensions&&c.extensions[m.KHR_DRACO_MESH_COMPRESSION]?n(c):X(new THREE.BufferGeometry,c,r),t[d]={primitive:c,promise:u},o.push(u)}return Promise.all(o)},V.prototype.loadMesh=function(u){for(var c=this,e=this.json,d=(this.extensions,e.meshes[u]),h=d.primitives,t=[],r=0,a=h.length;r<a;r++){var n=void 0===h[r].material?s=s||new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide}):this.getDependency("material",h[r].material);t.push(n)}return Promise.all(t).then(function(p){return c.loadGeometries(h).then(function(e){for(var t=[],r=0,a=e.length;r<a;r++){var n,s=e[r],i=h[r],o=p[r];if(i.mode===y||i.mode===L||i.mode===_||void 0===i.mode)!0===(n=!0===d.isSkinnedMesh?new THREE.SkinnedMesh(s,o):new THREE.Mesh(s,o)).isSkinnedMesh&&n.normalizeSkinWeights(),i.mode===L?n.drawMode=THREE.TriangleStripDrawMode:i.mode===_&&(n.drawMode=THREE.TriangleFanDrawMode);else if(i.mode===R)n=new THREE.LineSegments(s,o);else if(i.mode===S)n=new THREE.Line(s,o);else if(i.mode===M)n=new THREE.LineLoop(s,o);else{if(i.mode!==g)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+i.mode);n=new THREE.Points(s,o)}0<Object.keys(n.geometry.morphAttributes).length&&k(n,d),n.name=d.name||"mesh_"+u,1<e.length&&(n.name+="_"+r),B(n,d),c.assignFinalMaterial(n),t.push(n)}if(1===t.length)return t[0];var l=new THREE.Group;for(r=0,a=t.length;r<a;r++)l.add(t[r]);return l})})},V.prototype.loadCamera=function(e){var t,r=this.json.cameras[e],a=r[r.type];if(a)return"perspective"===r.type?t=new THREE.PerspectiveCamera(THREE.Math.radToDeg(a.yfov),a.aspectRatio||1,a.znear||1,a.zfar||2e6):"orthographic"===r.type&&(t=new THREE.OrthographicCamera(a.xmag/-2,a.xmag/2,a.ymag/2,a.ymag/-2,a.znear,a.zfar)),void 0!==r.name&&(t.name=r.name),B(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},V.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return r.inverseBindMatrices=e,r})},V.prototype.loadAnimation=function(S){for(var y=this.json.animations[S],e=[],t=[],r=[],a=[],n=[],s=0,i=y.channels.length;s<i;s++){var o=y.channels[s],l=y.samplers[o.sampler],p=o.target,u=void 0!==p.node?p.node:p.id,c=void 0!==y.parameters?y.parameters[l.input]:l.input,d=void 0!==y.parameters?y.parameters[l.output]:l.output;e.push(this.getDependency("node",u)),t.push(this.getDependency("accessor",c)),r.push(this.getDependency("accessor",d)),a.push(l),n.push(p)}return Promise.all([Promise.all(e),Promise.all(t),Promise.all(r),Promise.all(a),Promise.all(n)]).then(function(e){for(var t=e[0],r=e[1],a=e[2],n=e[3],s=e[4],i=[],o=0,l=t.length;o<l;o++){var p=t[o],u=r[o],c=a[o],d=n[o],h=s[o];if(void 0!==p){var m;switch(p.updateMatrix(),p.matrixAutoUpdate=!0,I[h.path]){case I.weights:m=THREE.NumberKeyframeTrack;break;case I.rotation:m=THREE.QuaternionKeyframeTrack;break;case I.position:case I.scale:default:m=THREE.VectorKeyframeTrack}var E=p.name?p.name:p.uuid,f=void 0!==d.interpolation?P[d.interpolation]:THREE.InterpolateLinear,v=[];I[h.path]===I.weights?p.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&v.push(e.name?e.name:e.uuid)}):v.push(E);for(var T=0,g=v.length;T<g;T++){var R=new m(v[T]+"."+I[h.path],u.array,c.array,f);"CUBICSPLINE"===d.interpolation&&(R.createInterpolant=function(e){return new H(this.times,this.values,this.getValueSize()/3,e)},R.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),i.push(R)}}}var M=void 0!==y.name?y.name:"animation_"+S;return new THREE.AnimationClip(M,void 0,i)})},V.prototype.loadNode=function(e){var t=this.json,r=this.extensions,a=this,s=t.meshReferences,i=t.meshUses,o=t.nodes[e];return(!0===o.isBone?Promise.resolve(new THREE.Bone):void 0!==o.mesh?a.getDependency("mesh",o.mesh).then(function(e){var t;if(1<s[o.mesh]){var r=i[o.mesh]++;(t=e.clone()).name+="_instance_"+r,t.onBeforeRender=e.onBeforeRender;for(var a=0,n=t.children.length;a<n;a++)t.children[a].name+="_instance_"+r,t.children[a].onBeforeRender=e.children[a].onBeforeRender}else t=e;return void 0!==o.weights&&t.traverse(function(e){if(e.isMesh)for(var t=0,r=o.weights.length;t<r;t++)e.morphTargetInfluences[t]=o.weights[t]}),t}):void 0!==o.camera?a.getDependency("camera",o.camera):o.extensions&&o.extensions[m.KHR_LIGHTS_PUNCTUAL]&&void 0!==o.extensions[m.KHR_LIGHTS_PUNCTUAL].light?a.getDependency("light",o.extensions[m.KHR_LIGHTS_PUNCTUAL].light):Promise.resolve(new THREE.Object3D)).then(function(e){if(void 0!==o.name&&(e.name=THREE.PropertyBinding.sanitizeNodeName(o.name)),B(e,o),o.extensions&&N(r,e,o),void 0!==o.matrix){var t=new THREE.Matrix4;t.fromArray(o.matrix),e.applyMatrix(t)}else void 0!==o.translation&&e.position.fromArray(o.translation),void 0!==o.rotation&&e.quaternion.fromArray(o.rotation),void 0!==o.scale&&e.scale.fromArray(o.scale);return e})},V.prototype.loadScene=function(){function u(e,i,o,l){var p=o.nodes[e];return l.getDependency("node",e).then(function(c){return void 0===p.skin?c:l.getDependency("skin",p.skin).then(function(e){for(var t=[],r=0,a=(d=e).joints.length;r<a;r++)t.push(l.getDependency("node",d.joints[r]));return Promise.all(t)}).then(function(e){for(var t=!0===c.isGroup?c.children:[c],r=0,a=t.length;r<a;r++){for(var n=t[r],s=[],i=[],o=0,l=e.length;o<l;o++){var p=e[o];if(p){s.push(p);var u=new THREE.Matrix4;void 0!==d.inverseBindMatrices&&u.fromArray(d.inverseBindMatrices.array,16*o),i.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',d.joints[o])}n.bind(new THREE.Skeleton(s,i),n.matrixWorld)}return c});var d}).then(function(e){i.add(e);var t=[];if(p.children)for(var r=p.children,a=0,n=r.length;a<n;a++){var s=r[a];t.push(u(s,e,o,l))}return Promise.all(t)})}return function(e){var t=this.json,r=this.extensions,a=this.json.scenes[e],n=new THREE.Scene;void 0!==a.name&&(n.name=a.name),B(n,a),a.extensions&&N(r,n,a);for(var s=a.nodes||[],i=[],o=0,l=s.length;o<l;o++)i.push(u(s[o],n,t,this));return Promise.all(i).then(function(){return n})}}(),e}();